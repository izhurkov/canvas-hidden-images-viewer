class CanvasHiddenImagesViewer{constructor(a){this.options=a,this.name="CanvasHiddenImagesViewer",this.canvas=document.createElement("canvas"),this.canvas.style=`cursor: ${a.cursorVisible||"default"}`,this.ctx=this.canvas.getContext("2d"),a.root&&a.root.append(this.canvas),!a.backgroundImage,this.position={x:0,y:0},this.backgroundImage=new Image,this.backgroundImageLoaded=!1,this.hiddenImages=[],this.hiddenCount=0,this.loadedCount=0,this.radius=a.radius||100,this.drawIntervalId=!1,this.mask={radius:0,to:this.options.radius||100,easy:this.options.easy||"easeInOutCubic",duration:this.options.duration||.5};let b=this;this.canvas.addEventListener("mousemove",function(a){b.position=b.getPosition(a.offsetX,a.offsetY)}),this.canvas.addEventListener("mouseout",function(a){b.radiusTo(b.mask,{from:b.mask.radius,to:0,duration:b.mask.duration,easy:b.mask.easy},function(){b.endDraw()}),b.position=b.getPosition(a.offsetX,a.offsetY)}),this.canvas.addEventListener("mouseover",function(a){b.startDraw(),b.radiusTo(b.mask,{from:b.mask.radius,to:b.mask.to,duration:b.mask.duration,easy:b.mask.easy}),b.position=b.getPosition(a.offsetX,a.offsetY)}),this.redrawInterval=1e3/(a.fps||30),this.loadImages(a)}radiusTo(a,b,c){if(this.timeId&&(clearInterval(this.timeId),this.timeId=!1),!b)return;if("number"==typeof b.duration&&0===b.duration)return a.radius=b.to||1,void(c&&c());let d=b.easy?this[b.easy]:this.easeInOutCubic;if("undefined"==typeof d)return;let e=this,f=performance.now(),g=a.radius;this.timeId=setInterval(function(){let h=performance.now(),i=h-f;return i>(1e3*b.duration||1e3)?(a.radius=b.to||1,c&&c(),clearInterval(e.timeId),void(e.timeId=!1)):void(a.radius=Math.max(0,d(i,g,b.to||1,1e3*b.duration||1e3)))},this.redrawInterval)}linear(a,e,b,c){return e+(b-e)*a/c}easeInOutCubic(a,e,b,c){return(a/=c/2,1>a)?(b-e)/2*a*a*a+e:(a-=2,(b-e)/2*(a*a*a+2)+e)}easeOutElastic(e,f,b,c){let d=1.70158,g=0,h=b;return 0===e?f:1===(e/=c)?b:(g||(g=.3*c),h<Math.abs(b)?(h=b,d=g/4):d=g/(2*Math.PI)*Math.asin(b/h),h*Math.pow(2,-10*e)*Math.sin((e*c-d)*(2*Math.PI)/g)+b)}easeInQuad(a,e,b,c){return(b-e)*(a/=c)*a+e}easeOutQuad(a,e,b,c){return-(b-e)*(a/=c)*(a-2)+e}easeInOutQuad(a,e,b,c){return 1>(a/=c/2)?(b-e)/2*a*a+e:-(b-e)/2*(--a*(a-2)-1)+e}imagesLoaded(){this.backgroundImageLoaded&&(this.canvas.width=this.backgroundImage.width,this.canvas.height=this.backgroundImage.height,this.startDraw())}startDraw(){let a=this;this.drawIntervalId||(this.drawIntervalId=setInterval(function(){a.draw()},this.redrawInterval))}getPosition(a,b){let c=this.canvas.getBoundingClientRect();return{x:a*this.canvas.width/c.width,y:b*this.canvas.height/c.height}}endDraw(){clearInterval(this.drawIntervalId),this.drawIntervalId=!1}onMouseOver(a){this.position={x:a.offsetX,y:a.offsetY},this.draw()}loadImages(a){let b=this;for(let c in a.backgroundImage&&(this.backgroundImage.src=a.backgroundImage,this.backgroundImage.addEventListener("load",function(){b.backgroundImageLoaded=!0,b.imagesLoaded()}),this.backgroundImage.addEventListener("error",function(){}),this.getPosition()),this.hiddenCount=a.hiddenImages.length,this.loadedCount=0,a.hiddenImages){let d=a.hiddenImages[c],e=new Image;e.src=d.src,d.image=e,e.addEventListener("load",function(){b.hiddenImages.push(d),b.loadedCount++,b.imagesLoaded()}),e.addEventListener("error",function(){b.hiddenCount--,b.imagesLoaded()})}}draw(){let a=this.backgroundImage,b=this.hiddenImages,c=this.canvas,d=this.ctx;for(let e in d.clearRect(0,0,c.width,c.height),d.drawImage(a,0,0,c.width,c.height),b){let a=b[e];d.save(),d.beginPath(),d.moveTo(this.position.x,this.position.y),d.arc(this.position.x,this.position.y,this.mask.radius*this.canvas.width/this.canvas.offsetWidth,0,2*Math.PI),d.closePath(),d.clip(),d.drawImage(a.image,a.left||0,a.top||0,a.width||a.image.width,a.height||a.image.height),d.restore()}}}